<div class="form-dynamic">
    <div class="form-header">
        <div class="header-left">
            <div class="back">
                <swt-button text="Trở về" [class]="'back-btn'" [color]="ButtonColor.BASIC" [height]="32" [width]="80" (onClick)="back()"></swt-button>
            </div>
            <div class="form-title">
                <ng-container *ngIf="formMode === FormMode.Add">
                    {{title.add || 'Thêm thông tin'}}
                </ng-container>
                <ng-container *ngIf="formMode === FormMode.View">
                    {{title.view || 'Thông tin chi tiết'}}
                </ng-container>
                <ng-container *ngIf="formMode === FormMode.Edit">
                    {{title.edit || 'Sửa thông tin'}}
                </ng-container>
            </div>
        </div>
        <div class="header-right">
            <div class="btns">
                <!-- button tại add mode  -->
                <ng-container *ngIf="formMode === FormMode.Add">
                    <div class="cancel">
                        <swt-button text="Hủy bỏ" [color]="ButtonColor.WARN" [height]="32" [width]="80" (onClick)="back()">
                        </swt-button>
                    </div>
                    <div class="save-and-add">
                        <swt-button #saveAndAddBtn [actionPermissions]="[ActionPermission.Add]" [iconButtonType]="IconButtonType.SAVE" text="Lưu và thêm" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save(true)"></swt-button>
                    </div>
                    <div class="add">
                        <swt-button #saveBtn [actionPermissions]="[ActionPermission.Add]" [iconButtonType]="IconButtonType.SAVE" text="Lưu" [height]="32" [width]="100" (onClick)="save()"></swt-button>
                    </div>
                </ng-container>

                <!-- button tại edit mode  -->
                <ng-container *ngIf="formMode === FormMode.Edit">
                    <div class="save-and-add">
                        <swt-button #saveAndAddBtn [actionPermissions]="[ActionPermission.Edit, ActionPermission.Add]" [iconButtonType]="IconButtonType.SAVE" text="Lưu và thêm" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save(true)"></swt-button>
                    </div>

                    <div class="edit">
                        <swt-button [actionPermissions]="[ActionPermission.Edit]" #saveBtn [iconButtonType]="IconButtonType.SAVE" text="Lưu" [height]="32" [width]="100" (onClick)="save()"></swt-button>
                    </div>
                </ng-container>

                <!-- button tại view only mode  -->
                <ng-container *ngIf="formMode === FormMode.View">
                    <div class="delete">
                        <swt-button #deleteBtn [actionPermissions]="[ActionPermission.Delete]" text="Xóa" [color]="ButtonColor.WARN" [height]="32" [width]="80" (onClick)="confirmDelete()">
                        </swt-button>
                    </div>
                    <div class="edit">
                        <swt-button [actionPermissions]="[ActionPermission.Edit]" text="Sửa" [height]="32" [width]="80" (onClick)="edit()"></swt-button>
                    </div>
                </ng-container>
            </div>

            <!-- button more  -->
            <div class="btn-responsive" [matMenuTriggerFor]="moreBtns"></div>
        </div>
    </div>
    <div class="form-content">
        <!-- Loop qua từng group box  -->
        <div class="group-box" *ngFor="let groupbox of groupBoxes">

            <!-- Box name  -->
            <div class="box-name">
                {{groupbox.name}}
            </div>

            <!-- Loop qua từng field  -->
            <div class="box-content row">
                <div class="item" [ngClass]="'col-12 col-md-' + field.scale" *ngFor="let field of groupbox.groupBoxFields">
                    <div class="item-content" [ngClass]="field.required ? 'required' : ''">
                        <!-- <div class="title">{{field.title}} <span *ngIf="field.required" style="color: red">*</span></div> -->
                        <ng-container [ngSwitch]="field.type">
                            <!-- number  -->
                            <dx-number-box *ngSwitchCase="FormFieldType.Number" format="#,###" class="input" [(value)]="field.value" [min]="0" [readOnly]="formMode == FormMode.View" [label]="field.title || ''">
                            </dx-number-box>

                            <!-- date  -->
                            <dx-date-box *ngSwitchCase="FormFieldType.Date" type="date" class="input" [(ngModel)]="field.value" [readOnly]="formMode == FormMode.View" [label]="field.title || ''" [showClearButton]="true" [useMaskBehavior]="true"></dx-date-box>

                            <!-- select box  -->
                            <!-- <dx-select-box *ngSwitchCase="FormFieldType.ComboBox" class="select-box" displayExpr="value" valueExpr="id" placeholder="" noDataText="Không có dữ liệu" (onOpened)="getComboboxData(field)" [searchEnabled]="true" [dataSource]="field.pickList || []" [(value)]="field.value"
                                [readOnly]="formMode == FormMode.View" [label]="field.title || ''">
                            </dx-select-box> -->
                            <swt-combobox *ngSwitchCase="FormFieldType.ComboBox" class="select-box" displayExpr="value" valueExpr="id" placeholder="" noDataText="Không có dữ liệu" [isFetching]="isFetching" (onOpened)="getComboboxData(field)" [dataSource]="field.pickList || []" [value]="field.value"
                                (onValueChanged)="field.value =$event.value" [readOnly]="formMode == FormMode.View" [label]="field.title || ''"></swt-combobox>

                            <!-- check box  -->
                            <dx-check-box *ngSwitchCase="FormFieldType.CheckBox" [(value)]="field.value" [matTooltip]="field.placeholder || ''" [readOnly]="formMode == FormMode.View"></dx-check-box>

                            <!-- image  -->
                            <!-- <div *ngSwitchCase="FormFieldType.Image" class="choose-file">
                              <div class="title">{{field.title}} <span *ngIf="field.required" style="color: red">*</span></div>
                              <div class="upload-input">
                                <dx-file-uploader selectButtonText="Chọn ảnh" labelText="Hoặc kéo và thả ảnh vào đây" accept="image/*" uploadMode="instantly" [matTooltip]="field.placeholder || ''" [readOnly]="formMode == FormMode.View"></dx-file-uploader>
                              </div>
                            </div> -->

                            <!-- area text  -->
                            <dx-text-area *ngSwitchCase="FormFieldType.TextArea" class="input" [(ngModel)]="field.value" minHeight="240" [autoResizeEnabled]="true" [readOnly]="formMode == FormMode.View" [label]="field.title || ''"></dx-text-area>

                            <!-- text  -->
                            <dx-text-box *ngSwitchDefault class="input" [(ngModel)]="field.value" [readOnly]="formMode == FormMode.View" [label]="field.title || ''"></dx-text-box>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="form-footer">
    </div>

    <swt-saving *ngIf="isSaving"></swt-saving>
    <spinner-loading *ngIf="isLoading"></spinner-loading>
</div>

<mat-menu #moreBtns="matMenu">
    <div class="btn-responsive-menu">
        <!-- button tại add mode  -->
        <ng-container *ngIf="formMode === FormMode.Add">
            <div class="cancel">
                <swt-button text="Hủy bỏ" [color]="ButtonColor.BASIC" [buttonType]="ButtonType.STROKED" [height]="32" [width]="120" (onClick)="back()">
                </swt-button>
            </div>
            <div class="save-and-add">
                <swt-button #saveAndAddBtnR [actionPermissions]="[ActionPermission.Add]" [buttonType]="ButtonType.STROKED" text="Lưu và thêm" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save(true)">
                </swt-button>
            </div>
            <div class="add">
                <swt-button #saveBtnR [actionPermissions]="[ActionPermission.Add]" [buttonType]="ButtonType.STROKED" text="Lưu" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save()"></swt-button>
            </div>
        </ng-container>

        <!-- button tại edit mode  -->
        <ng-container *ngIf="formMode === FormMode.Edit">
            <div class="save-and-add">
                <swt-button #saveAndAddBtnR [actionPermissions]="[ActionPermission.Edit, ActionPermission.Add]" [buttonType]="ButtonType.STROKED" text="Lưu và thêm" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save(true)"></swt-button>
            </div>

            <div class="edit">
                <swt-button #saveBtnR [actionPermissions]="[ActionPermission.Edit]" text="Lưu" [buttonType]="ButtonType.STROKED" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="save()"></swt-button>
            </div>
        </ng-container>

        <!-- button tại view only mode  -->
        <ng-container *ngIf="formMode === FormMode.View">
            <div class="delete">
                <swt-button #deleteBtn [actionPermissions]="[ActionPermission.Delete]" [buttonType]="ButtonType.STROKED" text="Xóa" [color]="ButtonColor.WARN" [height]="32" [width]="120" (onClick)="confirmDelete()">
                </swt-button>
            </div>
            <div class="edit">
                <swt-button [actionPermissions]="[ActionPermission.Edit]" [buttonType]="ButtonType.STROKED" text="Sửa" [color]="ButtonColor.BASIC" [height]="32" [width]="120" (onClick)="edit()"></swt-button>
            </div>
        </ng-container>
    </div>
</mat-menu>